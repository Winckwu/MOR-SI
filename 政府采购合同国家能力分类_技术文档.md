# 政府采购合同国家能力分类 - 技术文档

## 项目概述

本项目旨在对政府采购合同数据进行国家能力分类，将采购人和合同名称分类为三种国家能力类型：
- **提取能力**：税务、海关、统计等收集资源/信息的机构
- **合规能力**：公安、检察、监狱、市场监管等监督执法机构
- **协调能力**：教育、医疗、水利、交通等提供公共服务的机构

---

## 一、数据标注阶段

### 1.1 数据来源

使用2015年政府采购合同数据作为训练数据集，共计约20,000条记录。

### 1.2 标注流程

使用Claude进行人工分类，采用批次处理方式：
- 总计100个批次
- 每批次约200条记录（最后一批66条）
- 批次1-99：每批200条，索引0-19599
- 批次100：66条，索引19600-19665

### 1.3 标注结果统计

| 类别 | 数量 | 比例 |
|------|------|------|
| 协调能力 | 13,386 | 70.50% |
| 提取能力 | 3,845 | 20.25% |
| 合规能力 | 1,756 | 9.25% |
| **总计** | **18,987** | **100%** |

> 注：移除了极少数"其他"类别后的有效标注数据

### 1.4 类别分布特征

```
协调能力 ████████████████████████████████████████████████████████████████████ 70.50%
提取能力 ████████████████████ 20.25%
合规能力 █████████ 9.25%
```

存在明显的类别不平衡问题，协调能力占比超过70%。

---

## 二、机器学习模型训练

### 2.1 数据预处理

#### 2.1.1 文本特征构建
```python
text = 采购人 + " " + 合同名称
```

#### 2.1.2 向量化方法对比

| 向量化方法 | 参数 | F1_macro |
|------------|------|----------|
| **TF-IDF char (2-4)** | analyzer='char', ngram_range=(2,4) | **0.9468** |
| TF-IDF char_wb (2-5) | analyzer='char_wb', ngram_range=(2,5) | 0.9423 |
| TF-IDF word (1-2) | analyzer='word', ngram_range=(1,2) | 0.8457 |
| TF-IDF word (1-3) | analyzer='word', ngram_range=(1,3) | 0.8457 |

**结论**：字符级TF-IDF (2-4 grams) 显著优于词级TF-IDF，提升约10%。

### 2.2 模型训练与评估

#### 2.2.1 数据划分
- 训练集：15,189条 (80%)
- 测试集：3,798条 (20%)
- 采用分层抽样保持类别比例

#### 2.2.2 模型性能对比

| 模型 | 准确率 | Precision | Recall | F1_macro | F1_weighted | AUC-ROC |
|------|--------|-----------|--------|----------|-------------|---------|
| **LinearSVC** | **0.9687** | 0.9507 | 0.9455 | **0.9478** | 0.9680 | 0.9931 |
| LogisticRegression | 0.9584 | 0.9425 | 0.9248 | 0.9327 | 0.9565 | **0.9942** |
| RandomForest | 0.9658 | 0.9483 | 0.9347 | 0.9409 | 0.9652 | 0.9949 |
| GradientBoosting | 0.9634 | 0.9481 | 0.9258 | 0.9363 | 0.9624 | 0.9877 |
| MultinomialNB | 0.9492 | 0.9292 | 0.9083 | 0.9170 | 0.9469 | 0.9880 |

#### 2.2.3 各类别详细指标

**LinearSVC模型：**

| 类别 | Precision | Recall | F1-Score | Support |
|------|-----------|--------|----------|---------|
| 协调能力 | 0.9830 | 0.9698 | 0.9764 | 2,678 |
| 合规能力 | 0.8434 | 0.9515 | 0.8942 | 351 |
| 提取能力 | 0.9329 | 0.9220 | 0.9274 | 769 |
| **加权平均** | **0.9693** | **0.9687** | **0.9688** | **3,798** |

**LogisticRegression模型：**

| 类别 | Precision | Recall | F1-Score | Support |
|------|-----------|--------|----------|---------|
| 协调能力 | 0.9830 | 0.9698 | 0.9764 | 2,678 |
| 合规能力 | 0.8434 | 0.9515 | 0.8942 | 351 |
| 提取能力 | 0.9329 | 0.9220 | 0.9274 | 769 |

#### 2.2.4 混淆矩阵 (LinearSVC)

```
实际\预测      协调能力    合规能力    提取能力
协调能力         2633        15        30
合规能力           11       334         6
提取能力           34        26       709
```

#### 2.2.5 交叉验证结果 (5-Fold)

| 模型 | CV F1_macro Mean | CV F1_macro Std |
|------|------------------|-----------------|
| LinearSVC | 0.8796 | ±0.0401 |
| GradientBoosting | 0.8781 | ±0.0439 |
| RandomForest | 0.8720 | ±0.0450 |
| LogisticRegression | 0.8695 | ±0.0411 |
| MultinomialNB | 0.8163 | ±0.0666 |

### 2.3 类别不平衡处理

采用 `class_weight='balanced'` 参数自动调整类别权重：

```python
model = LinearSVC(class_weight='balanced', random_state=42, max_iter=3000)
```

效果：
- 合规能力召回率从约65%提升至92.59%
- 提取能力召回率从约80%提升至93.63%

### 2.4 AUC-ROC 曲线

| 模型 | AUC-ROC (macro) | AUC-ROC (weighted) |
|------|-----------------|-------------------|
| RandomForest | 0.9949 | 0.9954 |
| **LogisticRegression** | **0.9942** | **0.9947** |
| LinearSVC | 0.9931 | 0.9936 |
| MultinomialNB | 0.9880 | 0.9891 |
| GradientBoosting | 0.9877 | 0.9888 |

> 所有模型AUC-ROC均超过0.98，表明分类效果优秀。

---

## 三、模型应用与验证

### 3.1 2012-2014年数据分类

使用训练好的模型对2012-2014年数据进行分类预测：

| 年份 | 数据量 | 协调能力 | 合规能力 | 提取能力 |
|------|--------|----------|----------|----------|
| 2012 | 51 | 46 (90.2%) | 4 (7.8%) | 1 (2.0%) |
| 2013 | 121 | 116 (95.9%) | 4 (3.3%) | 1 (0.8%) |
| 2014 | 676 | 636 (94.1%) | 25 (3.7%) | 15 (2.2%) |
| **合计** | **848** | **798 (94.1%)** | **33 (3.9%)** | **17 (2.0%)** |

### 3.2 分类结果示例

**提取能力（正确识别）：**
- 国家税务总局 | 吉林省国家税务局国际税多功能一体机
- 湖北省孝感市国家税务局 | 服务器采购合同
- 国家统计局邹平调查队 | 平板电脑和录音笔采购

**合规能力（正确识别）：**
- 酒泉市公安局交通警察支队 | 营房改造采购项目
- 腾冲出入境检验检疫局 | 采购合同书
- 安宁市公安局 | 视频侦查分析检索系统

**协调能力（正确识别）：**
- 徽县教育局 | 改薄设备采购合同
- 中国科学院上海天文台 | 望远镜机械系统
- 重庆工商大学 | 图书馆服务器采购

---

## 四、Claude LLM理解分类复核

### 4.1 复核方法

对全部848条2012-2014年数据进行**逐条LLM理解分类**（与标注2015年训练数据相同的方法），而非简单的关键词匹配。

**分类依据（基于机构职能理解）：**

| 类别 | 核心职能 | 典型机构 |
|------|----------|----------|
| **提取能力** | 收集资源/信息 | 税务局、海关、统计局、外汇管理局 |
| **合规能力** | 监督执法、维护秩序 | 公安、检察院、法院、监狱、市场监管、检验检疫、海事局 |
| **协调能力** | 提供公共服务 | 教育、医疗、水利、交通、科研、文化 |

**边界案例处理原则：**
- 海事局：虽然提供航运服务，但主要职能是海上执法监管 → **合规能力**
- 环保局：环境监测与执法并重，根据具体采购内容判断
- 检验检疫：属于监督执法职能 → **合规能力**

### 4.2 复核结果

| 指标 | 数值 |
|------|------|
| 总数据量 | 848条 |
| 一致数量 | 835条 |
| **一致率** | **98.47%** |
| 不一致数量 | 13条 |

### 4.3 按年份统计

| 年份 | 总数 | 一致 | 一致率 |
|------|------|------|--------|
| 2012 | 51 | 51 | 100.00% |
| 2013 | 121 | 121 | 100.00% |
| 2014 | 676 | 663 | 98.08% |

### 4.4 不一致记录分析

| 分歧类型 | 数量 | 主要原因 |
|----------|------|----------|
| ML→协调, Claude→合规 | 8 | 海事局（ML未识别为执法机构） |
| ML→合规, Claude→协调 | 2 | 环保局（边界案例） |
| ML→提取, Claude→协调 | 3 | 财政局、国土资源局（ML误判为资源收集） |

**主要分歧机构：**
- **海事局** (8条)：Claude认为是执法机构（合规能力），ML误判为服务机构（协调能力）
- **环保局** (2条)：存在服务与执法双重职能的边界案例
- **财政局/国土资源局** (3条)：ML误判为提取能力，实际为协调能力

---

## 五、多模型对比与最优模型选择

### 5.1 与Claude LLM理解分类一致率对比

| 排名 | 模型 | 一致数 | 与Claude一致率 |
|------|------|--------|----------------|
| 🥇 | **LogisticRegression** | **835/848** | **98.47%** |
| 🥈 | LinearSVC | 828/848 | 97.64% |
| 🥈 | GradientBoosting | 828/848 | 97.64% |
| 🥈 | SGD_hinge | 828/848 | 97.64% |
| 5 | RandomForest | 827/848 | 97.52% |
| 6 | LinearSVC_C0.1 | 825/848 | 97.29% |
| 7 | SGD_log | 825/848 | 97.29% |
| 8 | MLP_256_128 | 818/848 | 96.46% |
| 9 | LinearSVC_C10 | 817/848 | 96.34% |

### 5.2 最优模型选择

**选定模型：LogisticRegression + TF-IDF char (2-4 grams)**

选择理由：
1. 与Claude LLM理解分类一致率最高 (98.47%)
2. AUC-ROC指标优秀 (0.9942)
3. 训练速度快，模型可解释性强
4. 仅13条记录与LLM判断不同（主要是海事局等边界案例）

### 5.3 最优模型配置

```python
from sklearn.linear_model import LogisticRegression
from sklearn.feature_extraction.text import TfidfVectorizer

# 向量化器
vectorizer = TfidfVectorizer(
    analyzer='char',
    ngram_range=(2, 4),
    max_features=15000,
    min_df=2
)

# 模型
model = LogisticRegression(
    class_weight='balanced',
    random_state=42,
    max_iter=1000
)

# 训练
X = vectorizer.fit_transform(texts)
model.fit(X, labels)

# 预测
X_new = vectorizer.transform(new_texts)
predictions = model.predict(X_new)
```

---

## 六、生成文件清单

| 文件名 | 说明 |
|--------|------|
| `classification_batch*.csv` | 100个批次的标注数据 |
| `2012_classified_ml.csv` | 2012年51条分类结果 |
| `2013_classified_ml.csv` | 2013年121条分类结果 |
| `2014_classified_pure_ml.csv` | 2014年676条分类结果 |
| `claude_llm_vs_ml_comparison.csv` | 848条LLM理解分类与ML对比结果 |
| `pure_ml_comparison.csv` | 纯ML模型对比结果 |
| `model_comparison_with_claude.csv` | 多模型与Claude对比结果 |
| `ml_model_metrics_detailed.csv` | 详细模型指标 |
| `classify_new_data.py` | 分类器脚本（用于新数据） |
| `使用说明_分类新数据.md` | 分类器使用说明 |
| `claude_llm_classification.py` | Claude LLM理解分类脚本 |

---

## 七、结论与建议

### 7.1 主要结论

1. **字符级TF-IDF显著优于词级TF-IDF**：提升约10%的F1分数
2. **类别权重平衡有效解决类别不平衡**：少数类召回率从65%提升至92%+
3. **LogisticRegression在实际应用中表现最佳**：与Claude LLM理解分类一致率达98.47%
4. **模型泛化能力良好**：在2012-2014年数据上表现稳定

### 7.2 使用建议

1. 对于新数据分类，推荐使用 LogisticRegression + TF-IDF char (2-4)
2. 对于边界案例（如环保局、海事局），可能需要人工复核
3. 定期用新标注数据更新模型以保持准确性

### 7.3 局限性

1. 环保局、海事局等机构的分类存在争议（边界案例）
2. 采购人名称过于简略时可能影响分类准确性
3. 模型依赖于训练数据的分布，对新出现的机构类型可能需要重新训练

---

*文档生成日期：2025年*
*数据处理与分析：Claude LLM + Python (scikit-learn)*
